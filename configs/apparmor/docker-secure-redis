#include <tunables/global>

profile docker-secure-redis flags=(attach_disconnected,mediate_deleted) {
    #include <abstractions/base>

    # Allow network access
    network inet tcp,
    network inet udp,

    # Redis binary
    /usr/local/bin/redis-server rx,

    # Redis configuration files
    /usr/local/etc/redis/** r,

    # Log files
    /var/log/redis/ rw,
    /var/log/redis/* rw,

    # PID file
    /var/run/redis_*.pid rw,

    # Deny write access to sensitive areas
    deny /etc/** w,
    deny /bin/** w,
    deny /usr/bin/** w,

    # Allow capability needed by Redis
    capability dac_override,
    capability net_bind_service,
}